names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6)
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all()
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
select(-value)
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value)
group_by(recipient_country, year) %>%
mutate(expenditure_alldiseases = sum(valu_millions, na.rm = TRUE)) %>%
ungroup() %>%
data_Q4_alldiseases <-world  %>%
left_join(spending_recipient_all_hiv_time, c("name_sort"="recipient_country")) %>%
rename(source=name_sort)
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value)
data_Q4_alldiseases <-world  %>%
left_join(spending_recipient_all_hiv_time, c("name_sort"="recipient_country")) %>%
rename(source=name_sort)
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(recipient_country, year) %>%
mutate(expenditure_alldiseases = sum(valu_millions, na.rm = TRUE)) %>%
ungroup()
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(recipient_country, year) %>%
mutate(expenditure_alldiseases = sum(valu_millions, na.rm = TRUE))
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(recipient_country, year) %>%
mutate(expenditure_alldiseases = sum(value_millions, na.rm = TRUE))
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(recipient_country, year) %>%
summarise(expenditure_alldiseases = sum(value_millions, na.rm = TRUE))
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(recipient_country, year) %>%
summarise(expenditure_alldiseases = sum(value_millions, na.rm = TRUE)) %>%
ungroup()
data_Q4_alldiseases <-world  %>%
left_join(spending_recipient_all_hiv_time, c("name_sort"="recipient_country")) %>%
rename(source=name_sort)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases,
mapping = aes(fill = value_millions)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 1)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by countries"
)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases,
mapping = aes(fill = xpenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 1)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by countries"
)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 1)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by countries"
)
spending_source_hiv_time<- read_csv("Data/IHME_DAH_DATABASE_1990_2019_Y2020M04D23.CSV") %>%
dplyr::select(source, year,contains(c("hiv", "mal", "tb", "ncd"))) %>%
mutate_at(vars(starts_with("hiv")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("mal")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("tb")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("ncd")),funs(as.numeric))
spending_source_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(source, year) %>%
summarise(expenditure_alldiseases = sum(value_millions, na.rm = TRUE)) %>%
ungroup()
spending_source_all_hiv_time <- spending_source_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(source, year) %>%
summarise(expenditure_alldiseases = sum(value_millions, na.rm = TRUE)) %>%
ungroup()
spending_source_all_hiv_time <- spending_source_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(source, year) %>%
summarise(expenditure_alldiseases = sum(value_millions, na.rm = TRUE)) %>%
ungroup()
data_Q4_alldiseases <-world  %>%
left_join(spending_recipient_all_hiv_time, c("name_sort"="source")) %>%
rename(source=name_so
data_Q4_alldiseases_source <-world  %>%
data_Q4_alldiseases_source <-world  %>%
left_join(spending_source_all_hiv_time, c("name_sort"="source")) %>%
rename(source=name_sort)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_source,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 1)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by countries"
)
View(world)
data_Q4_alldiseases_source <-world  %>%
left_join(spending_source_all_hiv_time, c("name_long"="source")) %>%
rename(source=name_sort)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_source,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 1)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by countries"
)
View(spending_source_hiv_time)
View(world)
spending_source_hiv_time<- read_csv("Data/IHME_DAH_DATABASE_1990_2019_Y2020M04D23.CSV") %>%
dplyr::select(source, year,contains(c("hiv", "mal", "tb", "ncd"))) %>%
mutate_at(vars(starts_with("hiv")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("mal")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("tb")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("ncd")),funs(as.numeric)) %>%
clean_names()
View(sitg)
spending_source_hiv_time<- read_csv("Data/IHME_DAH_DATABASE_1990_2019_Y2020M04D23.CSV") %>%
dplyr::select(source, year,contains(c("hiv", "mal", "tb", "ncd"))) %>%
mutate_at(vars(starts_with("hiv")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("mal")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("tb")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("ncd")),funs(as.numeric)) %>%
clean_names() %>%
mutate(source=str_replace(source, "_"," "))
View(spending_source_hiv_time)
View(world)
spending_source_all_hiv_time <- spending_source_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(source, year) %>%
summarise(expenditure_alldiseases = sum(value_millions, na.rm = TRUE)) %>%
ungroup()
spending_source_all_hiv_time <- spending_source_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>10000) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(source, year) %>%
summarise(expenditure_alldiseases = sum(value_millions, na.rm = TRUE)) %>%
ungroup()
data_Q4_alldiseases_source <-world  %>%
left_join(spending_source_all_hiv_time, c("name_long"="source")) %>%
rename(source=name_sort)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_source,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 2)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by countries"
)
spending_recipient_hiv_time<- read_csv("Data/IHME_DAH_DATABASE_1990_2019_Y2020M04D23.CSV") %>%
dplyr::select(recipient_country, year,contains(c("hiv", "mal", "tb", "ncd"))) %>%
mutate_at(vars(starts_with("hiv")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("mal")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("tb")),funs(as.numeric)) %>%
mutate_at(vars(starts_with("ncd")),funs(as.numeric)) %>%   mutate(recipient_country=str_replace(source, "_"," "))
data_Q4_alldiseases_recipient <-world  %>%
left_join(spending_recipient_all_hiv_time, c("name_long"="recipient_country")) %>%
rename(source=name_sort)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_recipient,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 2,
state_length = 1)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by different countries in millions (USD)"
)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_recipient,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 3)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by different countries in millions (USD)"
)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_recipient,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 5)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by different countries in millions (USD)"
)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_source,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 5)+
labs(
title = "Year: {closest_state}",
subtitle = "Money spents by different countries (in millions USD)"
)
tmap_mode("view") # make interactive
tm_shape(dQ3) +
tm_polygons(col = "expenditure_alldiseases_millions",
style = "quantile",
palette = "-viridis")
tm_shape(dQ3) +
tm_polygons(col = "expenditure_alldiseases_millions",
style = "mean",
palette = "-viridis")
tm_shape(dQ3) +
tm_polygons(col = "expenditure_alldiseases_millions",
style = "quantile",
palette = "-viridis")
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_source,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 5)+
labs(
title = "Year: {closest_state}",
subtitle = "Money spents by different countries (in millions USD)"
)+
rcartocolor::scale_fill_carto_d(palette = "BuGn")+
guides(fill = guide_legend(title =  "Per Million CHF",
label.position = "bottom",
title.position = "top",
nrow = 1))+
theme(legend.position = "bottom")
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_source,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 5)+
labs(
title = "Year: {closest_state}",
subtitle = "Money spents by different countries (in millions USD)"
)+
rcartocolor::scale_fill_carto_c(palette = "BuGn")+
guides(fill = guide_legend(title =  "Per Million CHF",
label.position = "bottom",
title.position = "top",
nrow = 1))+
theme(legend.position = "bottom")
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_recipient,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 5)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by different countries in millions (USD)"
)+
rcartocolor::scale_fill_carto_c(palette = "BuGn")+
guides(fill = guide_legend(title =  "Per Million CHF",
label.position = "bottom",
title.position = "top",
nrow = 1))+
theme(legend.position = "bottom")
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>1000 ) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(recipient_country, year) %>%
summarise(expenditure_alldiseases = sum(value_millions, na.rm = TRUE)) %>%
ungroup()
spending_recipient_all_hiv_time <- spending_recipient_hiv_time%>%
pivot_longer(cols = contains(c("hiv", "mal", "tb", "ncd")),
names_to = "name", values_to = "value") %>%
#pivot_longer(!recipient_country, names_to = "name", values_to = "value") %>%
#mutate(value = as.numeric(value)) %>%
mutate(disease = str_extract(name, "[^_]+")) %>%
dplyr::select(-name) %>%
filter(value>1000 ) %>%
mutate(value_millions=value/1e6) %>%
distinct_all() %>%
dplyr::select(-value) %>%
group_by(recipient_country, year) %>%
summarise(expenditure_alldiseases = sum(value_millions, na.rm = TRUE)) %>%
ungroup()
data_Q4_alldiseases_recipient <-world  %>%
left_join(spending_recipient_all_hiv_time, c("name_long"="recipient_country")) %>%
rename(source=name_sort)
ggplot() +
geom_sf(
data = world)+
geom_sf(
data = data_Q4_alldiseases_recipient,
mapping = aes(fill = expenditure_alldiseases)
) +
gganimate::transition_states(year,
transition_length = 1,
state_length = 5)+
labs(
title = "Year: {closest_state}",
subtitle = "Money received by different countries in millions (USD)"
)+
rcartocolor::scale_fill_carto_c(palette = "BuGn")+
guides(fill = guide_legend(title =  "Per Million CHF",
label.position = "bottom",
title.position = "top",
nrow = 1))+
theme(legend.position = "bottom")
